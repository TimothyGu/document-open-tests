<!doctype html>
<meta charset="utf-8">

<script>
const { port1, port2 } = new MessageChannel();
setTimeout(() => {
  port2.onmessage = () => {
    parent.onMessage();
  };
  port1.postMessage('bleh');
  parent.onBeforeDocumentOpen();
  document.open();
  parent.onAfterDocumentOpen();
}, 10);
</script>
